<div class="home-dashboard">
  <div class="home-main-content">
    <div class="home-header">
      <div class="home-greeting">
        <fa-icon [icon]="faUserCircle" class="my-icon-lg"/>
        <div>
          <div class="home-welcome">Welcome back, {{ user.nickname }}!</div>
          <div class="home-quote">
            <fa-icon [icon]="faQuoteLeft" class="my-icon-sm"/>
            <span>{{ quote }}</span>
          </div>
        </div>
      </div>
    </div>
    <div class="home-quick-entry">
      <button class="home-quick-btn neon-cyan" [routerLink]="['/journals/diary/new']" type="button">
        <fa-icon [icon]="faBook" class="my-icon-md"/>
        New Diary
      </button>
      <button class="home-quick-btn neon-purple" [routerLink]="['/journals/dream/new']" type="button">
        <fa-icon [icon]="faMoon" class="my-icon-md"/>
        New Dream
      </button>
      <button class="home-quick-btn neon-green" [routerLink]="['/journals/ritual/new']" type="button">
        <fa-icon [icon]="faStar" class="my-icon-md"/>
        New Ritual
      </button>
    </div>

    <div class="home-quick-mood">
      <div class="home-section-header">
        <div class="home-section-title">Quick Mood</div>
        <a routerLink="/mood-history" class="mood-history-link">
          View History
          <fa-icon [icon]="faArrowRight" class="my-icon-sm"/>
        </a>
      </div>
      <div class="mood-selector">
        @for (option of moodOptions; track option.value) {
          <button
            type="button"
            class="mood-icon"
            [class.selected]="selectedMood === option.value"
            (click)="quickSetMood(option.value)"
            [title]="option.label">
            <fa-icon [icon]="option.icon" class="my-icon-md" [ngClass]="getMoodColor(option.value)" />
          </button>
        }
      </div>
      @if (selectedMood) {
        <div class="mood-status">
          <span>Current mood: <strong>{{ getMoodLabel(selectedMood) }}</strong></span>
          <span class="mood-timestamp">{{ moodTimestamp | date: 'HH:mm' }}</span>
        </div>
      }
    </div>
    <div class="home-recent-entries">
      <div class="home-section-title">Recent Entries</div>
      @for (entry of recentEntries; track entry) {
        <div class="home-entry-card scale-up" [ngClass]="{'neon-glow-hover': entry.journal_type === 'diary', 'neon-glow-purple-hover': entry.journal_type === 'dream', 'neon-glow-green-hover': entry.journal_type === 'ritual', 'neon-glow-pink-hover': entry.journal_type === 'divination'}"
             [routerLink]="['/journals', entry.journal_type, entry.id]"
             type="button">
          <fa-icon
            [icon]="entry.journal_type === 'diary' ? faBook : entry.journal_type === 'dream' ? faMoon : entry.journal_type === 'ritual' ? faStar : faCrown"
            class="my-icon-sm"/>
          <div class="home-entry-info">
            <div class="home-entry-title">
              {{ entry.title }}
            </div>
            <div class="home-entry-date">{{ entry.created_at | date: 'dd MMM yyyy, HH:mm'}}</div>
            <div class="home-entry-snippet" [innerHTML]="entry.entry | markdown"></div>
          </div>
          @if (entry.mood) {
            <span class="home-entry-mood" [title]="getMoodLabel(entry.mood)">
              <fa-icon [icon]="getMoodIcon(entry.mood)" class="my-icon-sm" [ngClass]="getMoodColor(entry.mood)"/>
            </span>
          }
          <div class="home-entry-actions">
            <button class="home-entry-action-btn edit" (click)="editJournal($event, entry)" title="Edit">
              <fa-icon [icon]="faEdit" class="my-icon-sm"/>
            </button>
            <button class="home-entry-action-btn delete" (click)="deleteJournal($event, entry)" title="Delete">
              <fa-icon [icon]="faTrash" class="my-icon-sm"/>
            </button>
          </div>
        </div>
      }
      <a routerLink="/journals" class="home-view-all-link">
        View All Entries
        <fa-icon [icon]="faArrowRight" class="my-icon-sm"/>
      </a>
    </div>

  </div>
  <div class="home-sidebar">
    <div class="home-calendar">
      <div class="home-calendar-header">
        <span class="calendar-month-label">{{ monthName }} {{ currentYear }}</span>
      </div>
      <div class="home-calendar-grid">
        @for (day of calendarDays; track day.date.toISOString()) {
          <div class="home-calendar-cell"
               [ngClass]="{
                 'has-entry': day.entries.length > 0,
                 'has-mood': day.dominantMood,
                 'not-current': !day.isCurrentMonth
               }">
            <span>{{ day.date | date:'dd' }}</span>
            <div class="day-indicators">
              @if (day.dominantMood) {
                <div class="day-mood-indicator" [ngClass]="getMoodColor(day.dominantMood)"
                     [title]="getMoodLabel(day.dominantMood)">
                  <fa-icon [icon]="getMoodIcon(day.dominantMood)" class="my-icon-xs" />
                </div>
              }
            </div>
          </div>
        }
      </div>
    </div>

    <div class="home-stats">
      <div class="home-section-title">Stats & Insights</div>
      <div class="home-stats-row">
        <div class="home-stat">
          <fa-icon [icon]="faBook" class="my-icon-sm"/>
          {{ stats.stats.diary || 0 }} Diaries
        </div>
        <div class="home-stat">
          <fa-icon [icon]="faMoon" class="my-icon-sm"/>
          {{ stats.stats.dream || 0 }} Dreams
        </div>
        <div class="home-stat">
          <fa-icon [icon]="faStar" class="my-icon-sm"/>
          {{ stats.stats.ritual || 0 }} Rituals
        </div>
        <div class="home-stat">
          <fa-icon [icon]="faCrown" class="my-icon-sm"/>
          {{ stats.stats.divination || 0 }} Divinations
        </div>
        <div class="home-stat">
          <fa-icon [icon]="faList" class="my-icon-sm"/>
          {{ stats.total }} Total
        </div>
      </div>
    </div>

  </div>

</div>
