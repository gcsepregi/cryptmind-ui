<div class="diary-entry-root">
  <div class="diary-entry-container">
    <button [routerLink]="['/journals']" class="diary-entry-back" type="button">
      <fa-icon [icon]="faArrowLeft" class="my-icon" />
      Back to Journals
    </button>
    <h1 class="diary-entry-title">
      <fa-icon [icon]="faMoon" class="my-icon" />
      @if (entryId) {
        Update
      } @else {
        New
      }
      Dream Entry
    </h1>
    <form class="diary-entry-form" [formGroup]="form" (ngSubmit)="onSubmit()">
      <div class="diary-entry-group">
        <label for="title">Title</label>
        <input type="text" id="title" name="title" placeholder="Dream title" formControlName="title" required/>
      </div>

      <!-- Dream Metadata Fields -->
      <div class="diary-entry-metadata">
        <div class="diary-entry-group">
          <label for="dream_date">
            <fa-icon [icon]="faCalendarAlt" class="my-icon" />
            Dream Date
          </label>
          <input type="date" id="dream_date" name="dream_date" formControlName="dream_date"/>
        </div>

        <div class="diary-entry-group">
          <label>
            <fa-icon [icon]="faSmile" class="my-icon" />
            Mood
          </label>
          <div class="mood-selector">
            @for (option of moodOptions; track option.value) {
              <button
                type="button"
                class="mood-icon"
                [class.selected]="selectedMood === option.value"
                (click)="selectMood(option.value)"
                [title]="option.label">
                <fa-icon [icon]="option.icon" class="my-icon" />
              </button>
            }
          </div>
          <!-- Hidden input to maintain form binding -->
          <input type="hidden" formControlName="mood"/>
        </div>

        <div class="diary-entry-group">
          <label for="location">
            <fa-icon [icon]="faMapMarkerAlt" class="my-icon" />
            Location
          </label>
          <input type="text" id="location" name="location" placeholder="Where did you dream?" formControlName="location"/>
        </div>

        <div class="diary-entry-group">
          <label for="lucidity_level">
            <fa-icon [icon]="faEye" class="my-icon" />
            Lucidity Level (1-5)
          </label>
          <div class="slider-container">
            <input type="range" id="lucidity_level" name="lucidity_level" min="1" max="5" step="1" formControlName="lucidity_level"/>
            <div class="slider-value">{{ form.value.lucidity_level }}</div>
          </div>
        </div>

        <div class="diary-entry-group">
          <label for="dream_clarity">
            <fa-icon [icon]="faStar" class="my-icon" />
            Dream Clarity (1-5)
          </label>
          <div class="slider-container">
            <input type="range" id="dream_clarity" name="dream_clarity" min="1" max="5" step="1" formControlName="dream_clarity"/>
            <div class="slider-value">{{ form.value.dream_clarity }}</div>
          </div>
        </div>
      </div>

      <div class="diary-entry-group diary-entry-group-textarea">
        <label for="entry">Entry</label>
        <app-markdown-editor (contentChange)="entryContentChanged($event)" [content]="form.value['entry']" [showHeader]="true"></app-markdown-editor>
      </div>

      <!-- Dream Signs -->
      <app-list-editor
        [formArray]="dreamSigns"
        [label]="'Dream Signs'"
        [icon]="faSignature"
        [placeholder]="'Add dream sign...'"
        (itemAdded)="onDreamSignAdded($event)"
        (itemRemoved)="onDreamSignRemoved($event)"
      ></app-list-editor>

      <!-- Dream Characters -->
      <app-list-editor
        [formArray]="dreamCharacters"
        [label]="'Dream Characters'"
        [icon]="faUsers"
        [placeholder]="'Add dream character...'"
        (itemAdded)="onDreamCharacterAdded($event)"
        (itemRemoved)="onDreamCharacterRemoved($event)"
      ></app-list-editor>

      <!-- Dream Emotions -->
      <app-list-editor
        [formArray]="dreamEmotions"
        [label]="'Dream Emotions'"
        [icon]="faSmile"
        [placeholder]="'Add emotion...'"
        (itemAdded)="onDreamEmotionAdded($event)"
        (itemRemoved)="onDreamEmotionRemoved($event)"
      ></app-list-editor>

      <!-- Tags -->
      <div class="diary-entry-group">
        <label for="tags">Tags <span class="diary-entry-tags-hint">(press Enter or comma)</span></label>
        <div class="diary-entry-tags-box">
          @for (tag of tags; track tag) {
            <span class="diary-entry-tag">
              {{ tag }}
              <button type="button" class="diary-entry-tag-remove" (click)="removeTag(tag)">
                <fa-icon [icon]="faXmark" class="my-icon" />
              </button>
            </span>
          }
          <input type="text" class="diary-entry-tag-input" placeholder="Add tag..." aria-label="Add tag" formControlName="tagInput" (keydown)="addTag($event)"/>
        </div>
      </div>

      <button type="submit" class="diary-entry-submit" [disabled]="form.invalid">
        <fa-icon [icon]="faMoon" class="my-icon" />
        @if (entryId) {
          Update Entry
        } @else {
          Create Entry
        }
      </button>
    </form>
  </div>
</div>
