<div class="diary-entry-root">
  <div class="diary-entry-container">
    <button [routerLink]="['/journals']" class="diary-entry-back" type="button">
      <fa-icon [icon]="faArrowLeft" class="my-icon" />
      Back to Journals
    </button>
    <h1 class="diary-entry-title">
      <fa-icon [icon]="faBook" class="my-icon" />
      @if (entryId) {
        Update
      } @else {
        New
      }
      Diary Entry
    </h1>
    <form class="diary-entry-form" [formGroup]="form" (ngSubmit)="onSubmit()">
      <div class="diary-entry-group">
        <label for="title">Title</label>
        <input type="text" id="title" name="title" placeholder="Entry title" formControlName="title" required/>
      </div>

      <!-- Metadata Fields -->
      <div class="diary-entry-metadata">
        <div class="diary-entry-group">
          <label for="diary_date">
            <fa-icon [icon]="faCalendarAlt" class="my-icon" />
            Date
          </label>
          <input type="date" id="diary_date" name="diary_date" formControlName="diary_date"/>
        </div>

        <div class="diary-entry-group">
          <label>
            <fa-icon [icon]="faSmile" class="my-icon" />
            Mood
          </label>
          <div class="mood-selector">
            @for (option of moodOptions; track option.value) {
              <button
                type="button"
                class="mood-icon"
                [class.selected]="selectedMood === option.value"
                (click)="selectMood(option.value)"
                [title]="option.label">
                <fa-icon [icon]="option.icon" class="my-icon" />
              </button>
            }
          </div>
          <!-- Hidden input to maintain form binding -->
          <input type="hidden" formControlName="mood"/>
        </div>

        <div class="diary-entry-group">
          <label for="location">
            <fa-icon [icon]="faMapMarkerAlt" class="my-icon" />
            Location
          </label>
          <input type="text" id="location" name="location" placeholder="Where are you?" formControlName="location"/>
        </div>
      </div>

      <div class="diary-entry-group diary-entry-group-textarea">
        <label for="entry">Entry</label>
        <app-markdown-editor (contentChange)="entryContentChanged($event)" [content]="form.value['entry']" [showHeader]="true"></app-markdown-editor>
      </div>

      <!-- Gratitude List -->
      <app-list-editor
        [formArray]="gratitudeList"
        [label]="'Gratitude List'"
        [icon]="faListUl"
        [placeholder]="'Add gratitude item...'"
        (itemAdded)="onGratitudeItemAdded($event)"
        (itemRemoved)="onGratitudeItemRemoved($event)"
      ></app-list-editor>

      <!-- Achievements -->
      <app-list-editor
        [formArray]="achievements"
        [label]="'Achievements'"
        [icon]="faTrophy"
        [placeholder]="'Add achievement...'"
        (itemAdded)="onAchievementItemAdded($event)"
        (itemRemoved)="onAchievementItemRemoved($event)"
      ></app-list-editor>

      <!-- Tags -->
      <div class="diary-entry-group">
        <label for="tags">Tags <span class="diary-entry-tags-hint">(press Enter or comma)</span></label>
        <div class="diary-entry-tags-box">
          @for (tag of tags; track tag) {
            <span class="diary-entry-tag">
              {{ tag }}
              <button type="button" class="diary-entry-tag-remove" (click)="removeTag(tag)">
                <fa-icon [icon]="faXmark" class="my-icon" />
              </button>
            </span>
          }
          <input type="text" class="diary-entry-tag-input" placeholder="Add tag..." aria-label="Add tag" formControlName="tagInput" (keydown)="addTag($event)"/>
        </div>
      </div>
      <button type="submit" class="diary-entry-submit" [disabled]="form.invalid">
        <fa-icon [icon]="faBook" class="my-icon" />
        @if (entryId) {
          Update Entry
        } @else {
          Create Entry
        }
      </button>
    </form>
  </div>
</div>
