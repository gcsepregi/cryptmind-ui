<div class="journals-root">
  <div class="journals-container">
    <div class="journals-dropdown-overlay" (click)="toggleNewEntryDropDown()" *ngIf="newEntryDropDownOpen"></div>
    <!-- Header -->
    <div class="journals-header">
      <div class="journals-header-row">
        <div class="journals-header-title">
          <lucide-icon [img]="BookAIcon" class="my-icon" size="24"/>
          <h1>Journal Entries</h1>
        </div>
        <div class="journals-dropdown">
          <button class="journals-dropdown-btn" type="button" (click)="toggleNewEntryDropDown()">
            <lucide-icon [img]="PlusIcon" class="my-icon" size="16"/>
            New Entry
            <span [ngClass]="{'chevron-open': newEntryDropDownOpen}" class="chevron-wrapper">
              <lucide-icon [img]="ChevronDownIcon" class="my-icon chevron" size="16"/>
            </span>
          </button>
          <div class="journals-dropdown-menu" *ngIf="newEntryDropDownOpen"
               [ngClass]="{'dropdown-animate': newEntryDropDownOpen}">
            <button [routerLink]="['diaries/new']" class="journals-dropdown-item" type="button">
              <lucide-icon [img]="BookAIcon" class="my-icon" size="24"/>
              New Diary Entry
            </button>
            <button class="journals-dropdown-item" type="button">
              <lucide-icon [img]="MoonIcon" class="my-icon" size="24"/>
              New Dream Entry
            </button>
            <button class="journals-dropdown-item" type="button">
              <lucide-icon [img]="StarIcon" class="my-icon" size="24"/>
              New Ritual Entry
            </button>
            <button class="journals-dropdown-item" type="button">
              <lucide-icon [img]="CrownIcon" class="my-icon" size="24"/>
              New Divination Entry
            </button>
          </div>
        </div>
      </div>
      <p class="journals-header-count">2 of 2 entries</p>
      <div class="journals-header-actions">
        <!-- Search -->
        <div class="journals-search">
          <span class="journals-search-icon"><lucide-icon [img]="SearchIcon" class="my-icon" size="24"/></span>
          <input type="text" class="journals-search-input" placeholder="Search entries..."/>
        </div>
        <!-- Type Filter -->
        <select class="journals-type-filter">
          <option value="all">All Types</option>
          <option value="diary">Diary</option>
          <option value="dream">Dream</option>
          <option value="ritual">Ritual</option>
          <option value="divination">Divination</option>
        </select>
        <!-- Privacy Toggle -->
        <button class="journals-privacy-toggle" type="button">
          <lucide-icon [img]="EyeIcon" class="my-icon" size="24"/>
          Show Private
        </button>
        <!-- View Mode Toggle -->
        <div class="journals-view-toggle">
          <button class="journals-view-btn" type="button" (click)="toggleView('grid')"
                  [ngClass]="{'journals-view-btn-active': view === 'grid'}">
            <lucide-icon [img]="GridIcon" class="my-icon" size="24"/>
          </button>
          <button class="journals-view-btn" type="button" (click)="toggleView('list')"
                  [ngClass]="{'journals-view-btn-active': view === 'list'}">
            <lucide-icon [img]="ListIcon" class="my-icon" size="24"/>
          </button>
          <button class="journals-view-btn" type="button" (click)="toggleView('calendar')"
                  [ngClass]="{'journals-view-btn-active': view === 'calendar'}">
            <lucide-icon [img]="CalendarIcon" class="my-icon" size="24"/>
          </button>
        </div>
      </div>
    </div>
    <!-- Error State (hidden by default) -->
    <div class="journals-error" style="display:none">Failed to load journal entries</div>
    <!-- Entries Grid/List -->
    <div class="journals-list" [ngClass]="{'journals-list-grid': view === 'grid', 'journals-list-list': view === 'list'}" *ngIf="journals && view !== 'calendar'">
      <ng-container *ngFor="let journal of journals | async">
        <div class="journals-card journals-card-{{journal.journal_type}}">
          <div class="journals-card-header">
            <span class="journals-card-type-icon"><lucide-icon [img]="icon(journal.journal_type)" class="my-icon" size="24"/></span>
            <span class="journals-card-type">{{ journal.journal_type }}</span>
            <span class="journals-card-private"><lucide-icon [img]="EyeOffIcon" class="my-icon" size="24"/></span>
            <div class="journals-card-actions">
              <button class="journals-card-edit" type="button">
                <lucide-icon [img]="EditIcon" class="my-icon" size="24"/>
              </button>
              <button class="journals-card-delete" type="button">
                <lucide-icon [img]="Trash2Icon" class="my-icon" size="24"/>
              </button>
            </div>
          </div>
          <h3 class="journals-card-title">{{ journal.title }}</h3>
          <p class="journals-card-content">{{ journal.entry }}</p>
          <div class="journals-card-tags">
            <span class="journals-card-tag" *ngFor="let tag of journal.tags.slice(0,2)">{{ tag.name }}</span>
          </div>
          <div class="journals-card-footer">
            <span class="journals-card-date"><lucide-icon [img]="CalendarIcon" class="my-icon" size="24"/>{{ journal.created_at | date:'dd MMM yyyy, HH:mm' }}</span>
            <span class="journals-card-tagcount"><lucide-icon [img]="TagIcon" class="my-icon" size="24"/>{{ journal.tags.length }} tags</span>
          </div>
        </div>
      </ng-container>
    </div>
    <div *ngIf="view === 'calendar'" class="journals-calendar-view">
      <div class="calendar-header">
        <button class="calendar-nav-btn" (click)="prevMonth()">&#8592;</button>
        <span class="calendar-title">{{ monthName }} {{ currentYear }}</span>
        <button class="calendar-nav-btn" (click)="nextMonth()">&#8594;</button>
      </div>
      <div class="calendar-grid calendar-days-row">
        <div class="calendar-day-label">Sun</div>
        <div class="calendar-day-label">Mon</div>
        <div class="calendar-day-label">Tue</div>
        <div class="calendar-day-label">Wed</div>
        <div class="calendar-day-label">Thu</div>
        <div class="calendar-day-label">Fri</div>
        <div class="calendar-day-label">Sat</div>
      </div>
      <div class="calendar-grid">
        <ng-container *ngFor="let day of calendarDays; let i = index">
          <div class="calendar-cell" [ngClass]="{'calendar-cell-other': !day.isCurrentMonth, 'calendar-cell-today': day.date.toDateString() === (today | date:'fullDate')}">
            <span class="calendar-cell-day-number" [ngClass]="{'calendar-cell-has-entry': hasEntryForDay(day.date)}">{{ day.date.getDate() }}</span>
            <span *ngIf="getEntryTypesForDay(day.date).length > 0" class="calendar-cell-entry-icons d-desktop">
              <ng-container *ngFor="let type of getEntryTypesForDay(day.date)">
                <span class="calendar-cell-entry-marker" [ngClass]="'calendar-marker-' + type">
                  <lucide-icon [img]="icon(type)" size="14" />
                </span>
              </ng-container>
            </span>
          </div>
        </ng-container>
      </div>
    </div>
  </div>
</div>
