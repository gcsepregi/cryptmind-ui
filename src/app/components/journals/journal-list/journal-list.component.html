<div class="journals-root">
  <div class="journals-container">
    @if (newEntryDropDownOpen) {
      <div class="journals-dropdown-overlay" (click)="toggleNewEntryDropDown()"></div>
    }
    <!-- Header -->
    <div class="journals-header">
      <div class="journals-header-row">
        <div class="journals-header-title">
          <fa-icon [icon]="faBook" class="my-icon" />
          <h1>Journal Entries</h1>
        </div>
        <div class="journals-dropdown">
          <button class="journals-dropdown-btn" type="button" (click)="toggleNewEntryDropDown()">
            <fa-icon [icon]="faPlus" class="my-icon" />
            New Entry
            <span [ngClass]="{'chevron-open': newEntryDropDownOpen}" class="chevron-wrapper">
              <fa-icon [icon]="faChevronDown" class="my-icon chevron" />
            </span>
          </button>
          @if (newEntryDropDownOpen) {
            <div class="journals-dropdown-menu"
              [ngClass]="{'dropdown-animate': newEntryDropDownOpen}">
              <button [routerLink]="['diaries/new']" class="journals-dropdown-item" type="button">
                <fa-icon [icon]="faBook" class="my-icon neon-text" />
                New Diary Entry
              </button>
              <button [routerLink]="['dreams/new']" class="journals-dropdown-item" type="button">
                <fa-icon [icon]="faMoon" class="my-icon neon-text-purple" />
                New Dream Entry
              </button>
              <button [routerLink]="['rituals/new']" class="journals-dropdown-item" type="button">
                <fa-icon [icon]="faStar" class="my-icon neon-text-green" />
                New Ritual Entry
              </button>
              <button class="journals-dropdown-item" type="button">
                <fa-icon [icon]="faCrown" class="my-icon neon-text-pink" />
                New Divination Entry
              </button>
            </div>
          }
        </div>
      </div>
      <p class="journals-header-count">2 of 2 entries</p>
      <div class="journals-header-actions">
        <!-- Search -->
        <div class="journals-search">
          <span class="journals-search-icon"><fa-icon [icon]="faSearch" class="my-icon" /></span>
          <input type="text" class="journals-search-input" placeholder="Search entries..."/>
        </div>
        <!-- Type Filter -->
        <select class="journals-type-filter">
          <option value="all">All Types</option>
          <option value="diary">Diary</option>
          <option value="dream">Dream</option>
          <option value="ritual">Ritual</option>
          <option value="divination">Divination</option>
        </select>
        <!-- Privacy Toggle -->
        <button class="journals-privacy-toggle" type="button">
          <fa-icon [icon]="faEye" class="my-icon" />
          Show Private
        </button>
        <!-- View Mode Toggle -->
        <div class="journals-view-toggle">
          <button class="journals-view-btn" type="button" (click)="toggleView('grid')"
            [ngClass]="{'journals-view-btn-active': view === 'grid'}">
            <fa-icon [icon]="faTableCells" class="my-icon" />
          </button>
          <button class="journals-view-btn" type="button" (click)="toggleView('list')"
            [ngClass]="{'journals-view-btn-active': view === 'list'}">
            <fa-icon [icon]="faList" class="my-icon" />
          </button>
          <button class="journals-view-btn" type="button" (click)="toggleView('calendar')"
            [ngClass]="{'journals-view-btn-active': view === 'calendar'}">
            <fa-icon [icon]="faCalendar" class="my-icon" />
          </button>
        </div>
      </div>
    </div>
    <!-- Error State (hidden by default) -->
    <div class="journals-error" style="display:none">Failed to load journal entries</div>
    <!-- Entries Grid/List -->
    @if (journals && view !== 'calendar') {
      <div class="journals-list" [ngClass]="{'journals-list-grid': view === 'grid', 'journals-list-list': view === 'list'}">
        @for (journal of journals | async; track journal) {
          <div class="journals-card journals-card-{{journal.journal_type}}" (click)="goToJournal(journal)">
            <div class="journals-card-header">
              <span class="journals-card-type-icon"><fa-icon [icon]="icon(journal.journal_type)" class="my-icon" /></span>
              <span class="journals-card-type">{{ journal.journal_type }}</span>
              <span class="journals-card-private"><fa-icon [icon]="faEyeSlash" class="my-icon" /></span>
              <div class="journals-card-actions">
                <button class="journals-card-edit" type="button">
                  <fa-icon [icon]="faEdit" class="my-icon" />
                </button>
                <button class="journals-card-delete" type="button" (click)="deleteJournal(journal)">
                  <fa-icon [icon]="faTrash" class="my-icon" />
                </button>
              </div>
            </div>
            <h3 class="journals-card-title">{{ journal.title }}</h3>
            <p class="journals-card-content">{{ journal.entry }}</p>
            <div class="journals-card-tags">
              @for (tag of journal.tags.slice(0,2); track tag) {
                <span class="journals-card-tag">{{ tag.name }}</span>
              }
              @if (journal.tags.length > 2) {
                <span class="journals-card-tag-more">+{{ journal.tags.length - 2 }} more</span>
              }
            </div>
            <div class="journals-card-footer">
              <span class="journals-card-date"><fa-icon [icon]="faCalendar" class="my-icon" />{{ journal.created_at | date:'dd MMM yyyy, HH:mm' }}</span>
              <span class="journals-card-tagcount"><fa-icon [icon]="faTag" class="my-icon" />{{ journal.tags.length }} tags</span>
            </div>
          </div>
        }
      </div>
    }
    @if (view === 'calendar') {
      <div class="journals-calendar-view">
        <div class="calendar-header">
          <button class="calendar-nav-btn" (click)="prevMonth()">&#8592;</button>
          <span class="calendar-title">{{ monthName }} {{ currentYear }}</span>
          <button class="calendar-nav-btn" (click)="nextMonth()">&#8594;</button>
        </div>
        <div class="calendar-grid calendar-days-row">
          <div class="calendar-day-label">Sun</div>
          <div class="calendar-day-label">Mon</div>
          <div class="calendar-day-label">Tue</div>
          <div class="calendar-day-label">Wed</div>
          <div class="calendar-day-label">Thu</div>
          <div class="calendar-day-label">Fri</div>
          <div class="calendar-day-label">Sat</div>
        </div>
        <div class="calendar-grid">
          @for (day of calendarDays; track day.date.toISOString(); let i = $index) {
            <div class="calendar-cell" [ngClass]="{'calendar-cell-other': !day.isCurrentMonth, 'calendar-cell-today': day.date.toDateString() === (today | date:'fullDate')}">
              <span class="calendar-cell-day-number" [ngClass]="{'calendar-cell-has-entry': hasEntryForDay(day.date)}">{{ day.date.getDate() }}</span>
              @if (getEntryTypesForDay(day.date).length > 0) {
                <span class="calendar-cell-entry-icons d-desktop">
                  @for (type of getEntryTypesForDay(day.date); track type) {
                    <span class="calendar-cell-entry-marker" [ngClass]="'calendar-marker-' + type">
                      <fa-icon [icon]="icon(type)" class="my-icon" style="font-size: 14px;" />
                    </span>
                  }
                </span>
              }
            </div>
          }
        </div>
      </div>
    }
  </div>
</div>
